{% assign card_product = product.selected_or_first_available_variant %}
{% if card_product.featured_image != blank %}
  {% assign variant_featured_image = card_product.featured_image %}
{% else %}
  {% assign variant_featured_image = product.featured_image %}
{% endif %}

{{ 'custom-product-card.css' | asset_url | stylesheet_tag }}

<div class="custom-product-card-">
  <div class="custom-product-card--image-wrapper">
    {% render 'responsive-picture', desktopImage: variant_featured_image, class: 'h-full' %}
  </div>
  <div class="custom-product-card--info center">
    <div class="custom-product-card--variant-select">
      {% for option in product.options_with_values %}
        {% if option.name == 'color' or option.name == 'Color' %}
          {% for value in option.values %}
            <input id="custom_variant_radio--{{ forloop.index }}" name="{{ option.name }}" type="radio" value="{{ value }}">
            <label for="custom_variant_radio--{{ forloop.index }}">{{ value }}</label>
          {% endfor %}
        {% endif %}
      {% endfor %}
    </div>
    <div class="custom-product-card--vendor">
      {{ product.vendor }}
    </div>
    <div class="custom-product-card--title">
      {{ card_product.title }}
    </div>
    <div class="custom-product-card--price-container">
      <span class="custom-product-card--price"> {{ card_product.price | money_with_currency }}</span>
      <span class="custom-product-card--price-on-sale"> {{ card_product.compare_at_price | money_with_currency }}</span>
    </div>
    <div class="custom-product-card--inventory {% if card_product.inventory_quantity < 15 %} low-stock {% else %} high-stock {% endif %}">
      {{ card_product.inventory_quantity }} in stock
    </div>
    <!-- Add to cart button -->
    <product-form data-section-id="{{ section.id }}">
                {%- form 'product',
                  product,
                  id: product_form_id,
                  class: 'form',
                  novalidate: 'novalidate',
                  data-type: 'add-to-cart-form'
                -%}
                  <input
                    type="hidden"
                    name="id"
                    value="{{ product.selected_or_first_available_variant.id }}"
                    class="product-variant-id"
                    {% if product.selected_or_first_available_variant.available == false %}
                      disabled
                    {% endif %}
                  >
                  <button
                    id="{{ product_form_id }}-submit"
                    type="submit"
                    name="add"
                    class="quick-add__submit button button--full-width button--secondary{% if horizontal_quick_add %} card--horizontal__quick-add{% endif %}"
                    aria-haspopup="dialog"
                    aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ product.id }}"
                    aria-live="polite"
                    data-sold-out-message="true"
                    {% if product.selected_or_first_available_variant.available == false %}
                      disabled
                    {% endif %}
                  >
                    <span>
                      {%- if product.selected_or_first_available_variant.available -%}
                        {{ 'products.product.add_to_cart' | t }}
                      {%- else -%}
                        {{ 'products.product.sold_out' | t }}
                      {%- endif -%}
                    </span>
                    <span class="sold-out-message hidden">
                      {{ 'products.product.sold_out' | t }}
                    </span>
                    {%- if horizontal_quick_add -%}
                      <span class="icon-wrap">{% render 'icon-plus' %}</span>
                    {%- endif -%}
                    {%- render 'loading-spinner' -%}
                  </button>
                {%- endform -%}
              </product-form>
  </div>
</div>
